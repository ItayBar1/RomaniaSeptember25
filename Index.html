<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>תוכנית טיול אינטראקטיבית לרומניה</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals with Teal Accent -->
    <!-- Application Structure Plan: A two-panel layout was chosen for optimal user experience. The right-side vertical timeline provides a constant overview of the entire 10-day trip, allowing for quick, non-linear navigation. Clicking a day updates the main content panel on the left. This panel is designed to present the day's information in digestible chunks: a summary, key highlights, a visual breakdown of activities, and two charts for spatial and temporal context (a map and an activity/drive chart). This structure transforms a static, linear document into an interactive dashboard, making the complex itinerary easier to understand, explore, and reference. -->
    <!-- Visualization & Content Choices: 
        - Itinerary Timeline (HTML/JS): Goal: Organize/Navigate. A clickable list of days to control the main view. Justification: Provides clear structure and easy access to any day's plan.
        - Daily Plan (HTML/JS): Goal: Inform. Uses icons (Unicode) and structured text to clearly present the schedule. Justification: More engaging and scannable than plain text.
        - Route Map (Chart.js Scatter Plot): Goal: Visualize Relationships/Location. An abstract map showing the locations for the entire trip, highlighting the current day's route. Justification: Gives a spatial sense of the journey without needing a complex map API.
        - Drive vs. Activity Chart (Chart.js Bar Chart): Goal: Compare/Inform. A simple bar chart showing the estimated time split for the day. Justification: Provides a quick visual cue about the pace and nature of each day (e.g., heavy driving vs. more sightseeing).
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Assistant', sans-serif;
            background-color: #f5f5f4; /* stone-100 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 280px;
            max-height: 300px;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #a8a29e; /* stone-400 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #78716c; /* stone-500 */
        }
    </style>
</head>
<body class="text-stone-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-teal-800">טיול לרומניה: המסלול המלא</h1>
            <p class="text-lg text-stone-600 mt-2">7 בספטמבר 2025 - 16 בספטמבר 2025</p>
        </header>

        <main class="flex flex-col md:flex-row-reverse gap-8">
            
            <aside id="timeline-nav" class="w-full md:w-1/4 lg:w-1/5 bg-white p-4 rounded-xl shadow-md flex-shrink-0">
                <h2 class="text-xl font-bold mb-4 text-center border-b pb-2">ציר הזמן של הטיול</h2>
                <div id="timeline-container" class="space-y-2">
                </div>
            </aside>

            <section id="details-panel" class="w-full md:w-3/4 lg:w-4/5 bg-white p-6 rounded-xl shadow-lg">
                <div id="day-content">
                </div>
            </section>

        </main>
    </div>

    <script>
        const itineraryData = [
            {
                day: 1,
                date: "7.9.25",
                title: "הגעה לבוקרשט",
                locations: ["בוקרשט"],
                intro: "היום הראשון מוקדש להגעה, התארגנות וסיור ראשוני בבירת רומניה, בוקרשט. נחווה את האווירה של העיר העתיקה ונתרשם מהמבנים המונומנטליים שלה.",
                plan: [
                    { time: "לפנות בוקר", icon: "✈️", description: "נחיתה בנמל התעופה אוטופני (OTP)." },
                    { time: "בוקר", icon: "🏨", description: "נסיעה למלון והתארגנות." },
                    { time: "אחר הצהריים", icon: "🏛️", description: "סיור רגלי בעיר העתיקה (Centrul Vechi) ובאזור ארמון הפרלמנט." },
                    { time: "ערב", icon: "🍽️", description: "ארוחת ערב באחת המסעדות התוססות של העיר העתיקה." }
                ],
                highlights: ["ארמון הפרלמנט", "העיר העתיקה"],
                driveTime: 1,
                activityTime: 8
            },
            {
                day: 2,
                date: "8.9.25",
                title: "סינאיה ובראשוב",
                locations: ["בוקרשט", "סינאיה", "בראשוב"],
                intro: "ביום השני ניקח את הרכב השכור ונצא צפונה אל 'פנינת הקרפטים', סינאיה, שם נבקר בטירה מהאגדות. נסיים את היום בעיר הסקסונית המקסימה בראשוב.",
                plan: [
                    { time: "בוקר", icon: "🚗", description: "איסוף הרכב השכור ונסיעה צפונה לסינאיה." },
                    { time: "צהריים", icon: "🏰", description: "ביקור בטירת פלש (Peleș Castle) המרהיבה ובמנזר סינאיה." },
                    { time: "אחר הצהריים", icon: "➡️", description: "המשך נסיעה לבראשוב והתארגנות במלון." },
                    { time: "ערב", icon: "🌃", description: "סיור ראשוני בעיר העתיקה של בראשוב." }
                ],
                highlights: ["טירת פלש", "מנזר סינאיה", "בראשוב"],
                driveTime: 3,
                activityTime: 6
            },
            {
                // Updated for user request: Moved 7 Ladders to Day 3.
                day: 3,
                date: "9.9.25",
                title: "קניון 7 הסולמות וטיול בבראשוב",
                locations: ["בראשוב", "קניון 7 הסולמות"],
                intro: "את היום נתחיל במסלול הרפתקני בקניון 7 הסולמות הסמוך לבראשוב, ולאחר מכן נחזור לעיר לטייל ולהכיר את מרכז העיר המקסים.",
                plan: [
                    { time: "בוקר", icon: "🧗", description: "נסיעה קצרה ליער שליד בראשוב וטיול רגלי בקניון 7 הסולמות (Canionul Șapte Scări)." },
                    { time: "צהריים", icon: "🚶‍♂️", description: "חזרה לבראשוב וסיור במרכז העיר העתיקה, הכולל את הכיכר המרכזית, הכנסייה השחורה והרחוב הצר ביותר." },
                    { time: "ערב", icon: "🍴", description: "ארוחת ערב ולינה בבראשוב." }
                ],
                highlights: ["קניון 7 הסולמות", "הכנסייה השחורה"],
                driveTime: 1,
                activityTime: 7
            },
            {
                // Updated for user request: Moved Bran Castle to Day 4.
                day: 4,
                date: "10.9.25",
                title: "טירת דרקולה ודרך לקניון ביקאז",
                locations: ["בראשוב", "בראן", "קניון ביקאז"],
                intro: "נבקר בטירת בראן המפורסמת, המוכרת כטירתו של דרקולה, ולאחר מכן נצא בנסיעה ארוכה מזרחה לכיוון קניון ביקאז, יעד הלינה שלנו.",
                plan: [
                    { time: "בוקר", icon: "🧛", description: "נסיעה קצרה לטירת בראן (Bran Castle) וסיור במקום." },
                    { time: "צהריים", icon: "🚗", description: "נסיעה ארוכה לכיוון אזור קניון ביקאז (Cheile Bicazului) והאגם האדום." },
                    { time: "אחר הצהריים", icon: "🏡", description: "הגעה לאזור הלינה בקניון ביקאז והתארגנות." },
                    { time: "ערב", icon: "🍴", description: "ארוחת ערב ולינה באזור ביקאז." }
                ],
                highlights: ["טירת בראן", "קניון ביקאז"],
                driveTime: 4.5,
                activityTime: 4
            },
            {
                // Unchanged from previous request.
                day: 5,
                date: "11.9.25",
                title: "טיפוס לפסגת טואקה ונסיעה לאטרה-דורניי",
                locations: ["קניון ביקאז", "פסגת טואקה", "אטרה-דורניי"],
                intro: "היום נצא לטיפוס מאתגר לפסגת טואקה במאסיף צ'אחלאו. נחווה נוף פנורמי מרהיב, ולאחר מכן נמשיך בנסיעה צפונה לעיירת הספא והקיט אטרה-דורניי.",
                plan: [
                    { time: "בוקר", icon: "⛰️", description: "נסיעה קצרה מאזור ביקאז לפארק הלאומי מאסיף צ'אחלאו. טיפוס לפסגת טואקה (Toaca Peak) דרך גרם המדרגות המפורסם." },
                    { time: "צהריים", icon: "🌲", description: "הליכה חזרה והמשך נסיעה ארוכה צפונה לכיוון אטרה-דורניי." },
                    { time: "אחר הצהריים", icon: "🛏️", description: "הגעה לאטרה-דורניי והתארגנות." },
                    { time: "ערב", icon: "🌃", description: "סיור רגלי בעיירה ולינה במקום." }
                ],
                highlights: ["פסגת טואקה", "נופי מאסיף צ'אחלאו", "אטרה-דורניי"],
                driveTime: 4,
                activityTime: 4
            },
            {
                day: 6,
                date: "12.9.25",
                title: "רכבת הקיטור וקלוז'-נאפוקה",
                locations: ["אטרה-דורניי", "וישאו-דה-סוס", "קלוז'-נאפוקה"],
                intro: "יום ארוך ומגוון. נתחיל בחוויה נוסטלגית בנסיעה ברכבת קיטור בעמק וישאו, ונסיים את היום בקלוז'-נאפוקה, בירתה הלא רשמית של טרנסילבניה.",
                plan: [
                    { time: "בוקר", icon: "🚂", description: "נסיעה לוישאו-דה-סוס וחווית נסיעה ברכבת הקיטור (Mocănița)." },
                    { time: "אחר הצהריים", icon: "🚗", description: "נסיעה ארוכה לכיוון קלוז'-נאפוקה." },
                    { time: "ערב", icon: "🌆", description: "הגעה לקלוז'-נאפוקה, עיר תוססת וצעירה, ולינה במקום." }
                ],
                highlights: ["רכבת הקיטור בוישאו", "קלוז'-נאפוקה"],
                driveTime: 6,
                activityTime: 4
            },
            {
                day: 7,
                date: "13.9.25",
                title: "שבת בקלוז'",
                locations: ["קלוז'-נאפוקה"],
                intro: "יום רגוע המוקדש לעיר קלוז'. נסייר במרכז ההיסטורי, נתרשם מהאדריכלות ונבקר בבית חב\"ד המקומי.",
                plan: [
                    { time: "בוקר", icon: "🕍", description: "סיור רגלי במרכז העיר של קלוז', כולל כיכר אונירי והמבנים הגותיים." },
                    { time: "אחר הצהריים", icon: "✡️", description: "בילוי בקלוז', כולל ביקור בבית חב\"ד המקומי." },
                    { time: "ערב", icon: "🌃", description: "לינה בקלוז'-נאפוקה." }
                ],
                highlights: ["כיכר אונירי", "בית חב\"ד"],
                driveTime: 0,
                activityTime: 8
            },
            {
                day: 8,
                date: "14.9.25",
                title: "אלבה יוליה וסיביו",
                locations: ["קלוז'-נאפוקה", "אלבה יוליה", "סיביו"],
                intro: "נפרדים מקלוז' ונוסעים דרומה. נבקר באלבה יוליה, עיר איחוד רומניה, עם מצודה מרשימה, ונמשיך לעיר סיביו, פנינה סקסונית עם 'בתים בעלי עיניים'.",
                plan: [
                    { time: "בוקר", icon: "🏛️", description: "נסיעה לאלבה יוליה וסיור במצודה ההיסטורית המרשימה." },
                    { time: "אחר הצהריים", icon: "👀", description: "המשך נסיעה לסיביו וסיור ראשוני בעיר העתיקה." },
                    { time: "ערב", icon: "🏨", description: "לינה בסיביו." }
                ],
                highlights: ["מצודת אלבה יוליה", "העיר העתיקה של סיביו"],
                driveTime: 3,
                activityTime: 6
            },
            {
                day: 9,
                date: "15.9.25",
                title: "דרך טרנספגרשן",
                locations: ["סיביו", "דרך טרנספגרשן", "אגם וידרארו"],
                intro: "היום המרכזי של הטיול לחובבי הנהיגה והנופים. נחצה את הרי הקרפטים באחת הדרכים היפות והמפותלות בעולם, דרך הטרנספגרשן, ונעצור בנקודות תצפית עוצרות נשימה.",
                plan: [
                    { time: "בוקר", icon: "🚗💨", description: "יציאה מסיביו ונסיעה על דרך טרנספגרשן." },
                    { time: "צהריים", icon: "🏔️", description: "עצירה באגם בלאה (Bâlea Lake) ובנקודות תצפית נוספות." },
                    { time: "אחר הצהריים", icon: "댐", description: "הגעה לסכר ואגם וידרארו (Vidraru)." },
                    { time: "ערב", icon: "🌲", description: "לינה באזור אגם וידרארו." }
                ],
                highlights: ["דרך טרנספגרשן", "אגם בלאה", "אגם וידרארו"],
                driveTime: 4,
                activityTime: 5
            },
            {
                day: 10,
                date: "16.9.25",
                title: "סיום הטיול וחזרה",
                locations: ["אגם וידרארו", "קורטאה דה ארג'ש", "בוקרשט"],
                intro: "ביום האחרון נבקר במנזר המלכותי בקורטאה דה ארג'ש, נסכם את החוויות וניסע חזרה לשדה התעופה בבוקרשט לטיסה הביתה.",
                plan: [
                    { time: "בוקר", icon: "⛪", description: "נסיעה לקורטאה-דה-ארג'ש וביקור במנזר המפואר." },
                    { time: "אחר הצהריים", icon: "🚗", description: "נסיעה לכיוון שדה התעופה אוטופני (OTP)." },
                    { time: "ערב", icon: "✈️", description: "החזרת הרכב השכור וטיסה הביתה." }
                ],
                highlights: ["מנזר קורטאה דה ארג'ש"],
                driveTime: 3,
                activityTime: 4
            }
        ];

        const locationsCoords = {
            "בוקרשט": { x: 7, y: 2 },
            "סינאיה": { x: 6.5, y: 4 },
            "בראשוב": { x: 6.8, y: 4.5 },
            "קניון 7 הסולמות": { x: 6.9, y: 4.6 },
            "בראן": { x: 6.3, y: 4.3 },
            "קניון ביקאז": { x: 8, y: 6 },
            "פסגת טואקה": {x: 8.2, y: 6.5 },
            "אטרה-דורניי": { x: 7, y: 8 },
            "וישאו-דה-סוס": { x: 5, y: 9 },
            "קלוז'-נאפוקה": { x: 4, y: 7 },
            "אלבה יוליה": { x: 4.5, y: 5 },
            "סיביו": { x: 5, y: 4.5 },
            "דרך טרנספגרשן": { x: 6, y: 3.5 },
            "אגם וידרארו": { x: 6, y: 3 },
            "קורטאה דה ארג'ש": { x: 6.2, y: 2.5 }
        };

        let activityChart, mapChart;
        let currentDayIndex = 0;

        const timelineContainer = document.getElementById('timeline-container');
        const dayContentContainer = document.getElementById('day-content');

        const geminiApiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=';
        const apiKey = 'AIzaSyDteorCQ1YkO896XSQEVyNeZ0ZUtMP3XRc'; 

        // Weather API configuration
        const weatherApiUrl = 'https://api.weatherapi.com/v1/current.json';
        const weatherApiKey = '9989fe473a594e3a84b211237250608';

        async function callGeminiApi(prompt, retries = 3) {
            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(geminiApiUrl + apiKey, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (response.status === 429 && i < retries - 1) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    if (!response.ok) {
                         throw new Error(`API call failed with status: ${response.status}`);
                    }
                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    }
                } catch (error) {
                    console.error("Error fetching from Gemini API:", error);
                }
            }
            return "אירעה שגיאה בטעינת המידע. אנא נסה שוב מאוחר יותר.";
        }

        async function getFunFact(locations) {
            const outputDiv = document.getElementById('funFactOutput');
            outputDiv.innerHTML = `<p class="text-center text-stone-500">טוען עובדה מהנה...</p>`;
            const prompt = `Provide a single, short, and interesting fun fact in Hebrew about one of the following locations in Romania: ${locations.join(", ")}. Do not include the location name at the beginning of the fact.`;
            const fact = await callGeminiApi(prompt);
            outputDiv.innerHTML = `<p class="p-3 bg-teal-100 text-teal-800 rounded-lg shadow-inner">${fact}</p>`;
        }

        async function getRainyDayActivity(locations) {
            const outputDiv = document.getElementById('rainyDayOutput');
            outputDiv.innerHTML = `<p class="text-center text-stone-500">מחפש רעיון ליום גשום...</p>`;
            const prompt = `Suggest one specific activity for a rainy day in Hebrew, based on the following locations in Romania: ${locations.join(", ")}. Make the suggestion short and friendly.`;
            const activity = await callGeminiApi(prompt);
            outputDiv.innerHTML = `<p class="p-3 bg-teal-100 text-teal-800 rounded-lg shadow-inner">${activity}</p>`;
        }

        // פונקציה חדשה: קריאה ל-WeatherAPI.com והצגת נתוני מזג האוויר
        async function fetchWeatherData(locationName) {
            const outputDiv = document.getElementById('weatherOutput');
            const placeholderCity = locationName.split(',')[0]; // השתמש בחלק הראשון של שם המיקום
            
            outputDiv.innerHTML = `<p class="text-center text-stone-500 dark:text-stone-400">טוען נתוני מזג אוויר עבור ${placeholderCity}...</p>`;

            if (!weatherApiKey) {
                outputDiv.innerHTML = `<p class="text-center text-stone-500 dark:text-stone-400">יש להזין מפתח API של WeatherAPI.com כדי להציג מזג אוויר.</p>`;
                return;
            }

            try {
                // Fetch weather data from WeatherAPI.com with the country specified.
                const query = `${placeholderCity}, Romania`;
                const response = await fetch(`${weatherApiUrl}?key=${weatherApiKey}&q=${query}&lang=he`);
                const data = await response.json();

                if (response.ok) {
                    const temp = Math.round(data.current.temp_c);
                    const description = data.current.condition.text;
                    const iconUrl = `https:${data.current.condition.icon}`;
                    
                    outputDiv.innerHTML = `
                        <div class="flex items-center justify-center p-3 rounded-lg shadow-inner bg-teal-100 text-teal-800 dark:bg-teal-700 dark:text-teal-100">
                            <img src="${iconUrl}" alt="${description}" class="w-12 h-12 ml-2">
                            <div>
                                <p class="text-xl font-bold">${temp}°C</p>
                                <p class="text-sm">${description}</p>
                            </div>
                        </div>
                    `;
                } else {
                    outputDiv.innerHTML = `<p class="text-center text-red-500">שגיאה: לא ניתן לטעון נתוני מזג אוויר עבור ${placeholderCity}.</p>`;
                    console.error("WeatherAPI.com API error:", data.error.message);
                }
            } catch (error) {
                outputDiv.innerHTML = `<p class="text-center text-red-500">שגיאה בחיבור לשירות מזג האוויר.</p>`;
                console.error("WeatherAPI.com fetch error:", error);
            }
        }


        function renderTimeline() {
            timelineContainer.innerHTML = '';
            itineraryData.forEach((day, index) => {
                const isActive = index === currentDayIndex;
                const button = document.createElement('button');
                button.className = `w-full text-right p-3 rounded-lg transition-all duration-300 text-lg ${isActive ? 'bg-teal-600 text-white shadow-md' : 'bg-stone-100 hover:bg-stone-200'}`;
                button.innerHTML = `<span class="font-bold">יום ${day.day}:</span> ${day.title}`;
                button.onclick = () => selectDay(index);
                timelineContainer.appendChild(button);
            });
        }

        function selectDay(index) {
            currentDayIndex = index;
            renderTimeline();
            renderDayDetails(itineraryData[index]);
        }

        function renderDayDetails(dayData) {
            dayContentContainer.innerHTML = `
                <div class="animate-fade-in">
                    <h2 class="text-3xl font-bold text-teal-700 mb-1">יום ${dayData.day}: ${dayData.title}</h2>
                    <p class="text-stone-500 mb-4 text-lg">${dayData.date}</p>
                    <p class="mb-6 text-base leading-relaxed">${dayData.intro}</p>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-stone-50 p-4 rounded-lg">
                            <h3 class="text-xl font-bold mb-3">תכנון היום</h3>
                            <div class="space-y-3">
                                ${dayData.plan.map(item => `
                                    <div class="flex items-start">
                                        <span class="text-2xl ml-3">${item.icon}</span>
                                        <div>
                                            <p class="font-semibold">${item.time}</p>
                                            <p class="text-stone-700">${item.description}</p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="bg-stone-50 p-4 rounded-lg">
                            <h3 class="text-xl font-bold mb-3">נקודות עניין מרכזיות</h3>
                            <ul class="list-none space-y-2">
                                ${dayData.highlights.map(highlight => `
                                    <li class="flex items-center"><span class="text-teal-500 text-2xl ml-2">◆</span>${highlight}</li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                    
                    <div class="border-t pt-6">
                        <h3 class="text-2xl font-bold text-center mb-4">ייצוג חזותי של היום</h3>
                        <p class="text-center text-stone-600 mb-6">התרשימים הבאים ממחישים את מסלול הנסיעה ואת חלוקת הזמן בין פעילויות לנהיגה, ומספקים מבט מהיר על אופי היום.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-stone-50 p-4 rounded-lg">
                                <h4 class="text-lg font-bold text-center mb-2">מסלול היום (מפה סכמטית)</h4>
                                <div class="chart-container">
                                    <canvas id="mapChart"></canvas>
                                </div>
                            </div>
                            <div class="bg-stone-50 p-4 rounded-lg">
                                <h4 class="text-lg font-bold text-center mb-2">זמן נסיעה מול פעילויות (שעות)</h4>
                                <div class="chart-container">
                                    <canvas id="activityChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="border-t pt-6 mt-6 text-center">
                        <h3 class="text-2xl font-bold text-center mb-4">✨ פיצ'רים של Gemini API</h3>
                        <div class="flex flex-col md:flex-row gap-4 justify-center mb-4">
                            <button id="funFactBtn" class="bg-stone-200 hover:bg-stone-300 text-stone-800 font-bold py-2 px-4 rounded-lg shadow-md transition-colors">
                                עובדה מהנה על מיקום ✨
                            </button>
                            <button id="rainyDayBtn" class="bg-stone-200 hover:bg-stone-300 text-stone-800 font-bold py-2 px-4 rounded-lg shadow-md transition-colors">
                                המלצה ליום גשום ✨
                            </button>
                        </div>
                        <div id="funFactOutput" class="mb-4"></div>
                        <div id="rainyDayOutput"></div>
                    </div>
                     <!-- New section for Weather API -->
                    <div class="border-t pt-6 mt-6 text-center">
                        <h3 class="text-2xl font-bold text-center mb-4">☁️ מזג אוויר</h3>
                        <div class="bg-stone-50 dark:bg-stone-800 p-4 rounded-lg">
                            <div id="weatherOutput">
                                <!-- Weather data will be displayed here dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('funFactBtn').onclick = () => getFunFact(dayData.locations);
            document.getElementById('rainyDayBtn').onclick = () => getRainyDayActivity(dayData.locations);

            renderCharts(dayData);
        }

        function renderCharts(dayData) {
            const activityCtx = document.getElementById('activityChart').getContext('2d');
            if (activityChart) {
                activityChart.destroy();
            }
            activityChart = new Chart(activityCtx, {
                type: 'bar',
                data: {
                    labels: ['חלוקת זמן'],
                    datasets: [
                        {
                            label: 'זמן נהיגה',
                            data: [dayData.driveTime],
                            backgroundColor: '#5eead4', // teal-300
                            borderColor: '#0d9488', // teal-600
                            borderWidth: 1
                        },
                        {
                            label: 'זמן פעילויות',
                            data: [dayData.activityTime],
                            backgroundColor: '#a8a29e', // stone-400
                            borderColor: '#57534e', // stone-600
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            grid: { display: false },
                             ticks: {
                                callback: function(value) {
                                    return value + ' שעות'
                                }
                            }
                        },
                        y: {
                            stacked: true,
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.x !== null) {
                                        label += context.parsed.x + ' שעות';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            const mapCtx = document.getElementById('mapChart').getContext('2d');
            if (mapChart) {
                mapChart.destroy();
            }

            const allPoints = Object.keys(locationsCoords).map(key => ({
                ...locationsCoords[key],
                label: key
            }));

            const dayPoints = dayData.locations.map(loc => ({
                ...locationsCoords[loc],
                label: loc
            }));

            mapChart = new Chart(mapCtx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'כלל היעדים',
                            data: allPoints,
                            backgroundColor: '#d6d3d1', // stone-300
                            pointRadius: 5,
                        },
                        {
                            label: 'מסלול היום',
                            data: dayPoints,
                            backgroundColor: '#14b8a6', // teal-500
                            pointRadius: 8,
                            borderColor: '#0f766e', // teal-700
                            borderWidth: 2,
                            showLine: true,
                            fill: false,
                            borderColor: '#14b8a6',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { display: false, min: 2, max: 10 },
                        y: { display: false, min: 1, max: 10 }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.raw.label;
                                }
                            }
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            selectDay(0);
        });
    </script>
</body>
</html>
